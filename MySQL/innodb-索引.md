# innoDB 索引

## 索引组织表

在 **InnoDB**的存储引擎中，表是根据主键顺序组织存放的，这种存储方式称为索引组织表。**innoDB**  存储引擎表中，每张表都有个 **Primary Key**。如果在创建表时没有显示的定义主键，则 **innoDB** 存储引擎会按如下方式选择或创建主键：

- 寻找表中定义的第一个非空唯一索引( **Unique NOT NULL** )。作为主键
- 如果不存在，自动创建一个6字节大小的指针。

## 常见索引

- B+ 树索引

- 全文索引

- 哈希索引

  **innoDB** 支持的哈希索引是自适应的，存储引擎会根据表的使用情况自动为表生成哈希索引，不能人为干预。

### B+ 树索引

#### 聚集索引

按照每张表的主键构造一棵B+ 树，叶子节点中存放的是整张表的**行记录数据**。也将聚集索引的叶子节点称做数据页。每张表只能拥有一个聚集索引。

#### 辅助索引

叶子节点并不包含行记录的全部数据。叶子节点包含键值以外，在索引行中还包含一个书签(bookmark)。该书签（即为相应行数据的聚集索引键）告诉 **innoDB** 存储引擎在哪里可以找到与索引相对应的行数据。

由于辅助索引并不影响聚集索引的组织，所以每张表上可以有多个辅助索引。当通过辅助索引寻找数据时， **innoDB** 存储引擎会遍历辅助索引并通过叶级别指针获得指向主键索引的主键，然后通过主键索引来找到一个完整的行记录

### B+ 树索引的使用

#### 联合索引

对表上的多个列进行索引。（内部节点中也包含相应的列）

#### 覆盖索引

又称**索引覆盖**。即从辅助索引中就可以得到查询的记录（**只在叶子节点中包含额外的列**），而不需要查询聚集索引中的记录。（可以解决**回表**问题。）由于辅助索引中不包含整行记录的所有信息，所以其大小要远小于聚集索引，可减少大量的IO操作。

### 全文检索

- 前缀查找 通过索引字段的前端进行查找。

#### 倒排索引

使用辅助表存储了**单词与单词自身**在一个或者多个**文档**及所在**位置**之间的映射。

#### innoDB 全文索引

使用全倒排索引。（word）->（文档ID，位置）。

